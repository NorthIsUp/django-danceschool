{% extends "cms/home.html" %}
{% load danceschool_tags crispy_forms_tags cms_tags %}

{% block title %}Complete Your Registration{% endblock %}

{% block content %}
<div class="regsummary">
	{% block summary %}

	    <h2>Hi {{ registration.firstName }}! </h2>
	    
	    <p>You are about to register for the following:</p>

	    <table class="table classregsummary">
		    <tr>
		        <th>Class/Event Name</th>
		        <th>Date(s)</th>
		        <th>Time</th>
		        <th>Role</th>
		        <th>Price</th>
		    </tr>

		    {% for item in registration.temporaryeventregistration_set.all %}
		    <tr>
		        <td>{% if item.dropIn %}DROP IN: {% endif %}{{ item.event.name }}</td>
		        <td>
		        {% if item.event.eventoccurrence_set.count == 4 and not item.event.series.special %}
		        	{{ item.event.startTime|date:"l" }}s in {{ item.event.month|readable_month }}, starting {{ item.event.startTime|date:"F jS" }}
		        {% else %}
		        	{% for occ in item.event.eventoccurrence_set.all reversed %}
		        		{{ occ.startTime|date:"D. F jS" }}{% if not forloop.last %}, {% endif %}
		        	{% endfor %}
		        {% endif %}
		        </td>
		        <td>{{ item.event.startTime|date:"P" }}</td>
		        <td>{{ item.role.name|default:"N/A" }}</td>
				<td>{{ currencySymbol }}{{ item.price|floatformat:"-2" }}</td>
		    </tr>
		    {% endfor %}
	    </table>

		{% if addonItems %}
		<p>
			{% for addon in addonItems %}
				<strong>Free Add-On:</strong>&nbsp;{{ addon.name }}
			{% endfor %}
		</p>
		{% endif %}

		<p>
			{% if discount_code_amount > 0 or total_voucher_amount > 0 %}
				{% if discount_code_name %}
					<strong>Discount Code Applied:</strong> {{ discount_code_name }}<br /><br />
				{% endif %}
				{% if voucher_names %}
					<strong>Vouchers Applied:</strong> {{ voucher_names|join:", " }}<br /><br />
				{% endif %}

				<strong>Total Discounts Applied:</strong> {{ currencySymbol }}{{ total_discount_amount|floatformat:"-2" }} <br /><br />
			{% endif %}

	        <div style="font-size: 1.2em;"><strong><em>Total:</em></strong> {{ currencySymbol }}{{ netPrice|floatformat:"-2" }}</div>
	    </p>

	{% endblock %}

	{% block payment_info %}

	    <p>
	     {% if is_free %}
	        Thanks! You're all set.
	     {% else %}
		     In order to complete your registration you must click on the Buy Now button to make a payment.</p>

		     {% if payAtDoor %}
		        <form action="" method="post">
		            {% crispy form %}
		        </form>
		     {% endif %}

		 	{% if payAtDoor %}
		 		<div class="panel panel-default">
		 			<div class="panel-heading">
		 				<h4 class="panel-title">Pay Directly (Requires User Login)</h4>
		 			</div>
		 			<div class="panel-body">
		 	{% endif %}

		 	{% static_placeholder "registration_payment_placeholder" %}

		 	{% if payAtDoor %}
		 			</div>
	 			</div>
		 	{% endif %} 
	    {% endif %}

	{% endblock %}

	{% block disclaimer %}
		{% static_placeholder "registration_summary_disclaimer" %}
	{% endblock %}

</div>
{% endblock %}
